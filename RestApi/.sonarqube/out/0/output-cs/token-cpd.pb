
9/Users/hakan/Documents/flo_2025_dotnet/RestApi/Startup.cs
public 
class 
Startup 
{ 
public		 

void		 
ConfigureServices		 !
(		! "
IServiceCollection		" 4
services		5 =
)		= >
{

 
var 
key 
= 
Encoding 
. 
ASCII  
.  !
GetBytes! )
() *
$str* j
)j k
;k l
services 
. 
AddAuthentication "
(" #
x# $
=>% '
{ 	
x 
. %
DefaultAuthenticateScheme '
=( )
JwtBearerDefaults* ;
.; < 
AuthenticationScheme< P
;P Q
x 
. "
DefaultChallengeScheme $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
;M N
} 	
)	 

. 	
AddJwtBearer	 
( 
x 
=> 
{ 	
x 
.  
RequireHttpsMetadata "
=# $
false% *
;* +
x 
. 
	SaveToken 
= 
true 
; 
x 
. %
TokenValidationParameters '
=( )
new* -%
TokenValidationParameters. G
{ $
ValidateIssuerSigningKey (
=) *
true+ /
,/ 0
IssuerSigningKey  
=! "
new# & 
SymmetricSecurityKey' ;
(; <
key< ?
)? @
,@ A
ValidateIssuer 
=  
false! &
,& '
ValidateAudience  
=! "
false# (
} 
; 
} 	
)	 

;
 
services 
. 
AddMvc 
( 
) 
; 
} 
public   

void   
	Configure   
(   
IApplicationBuilder   -
app  . 1
,  1 2
IWebHostEnvironment  3 F
env  G J
)  J K
{!! 
if"" 

("" 
env"" 
."" 
IsDevelopment"" 
("" 
)"" 
)""  
{## 	
app$$ 
.$$ %
UseDeveloperExceptionPage$$ )
($$) *
)$$* +
;$$+ ,
}%% 	
else&& 
{'' 	
app(( 
.(( 
UseHsts(( 
((( 
)(( 
;(( 
})) 	
app++ 
.++ 
UseHttpsRedirection++ 
(++  
)++  !
;++! "
app,, 
.,, 
UseAuthentication,, 
(,, 
),, 
;,,  
app-- 
.-- 
UseMvc-- 
(-- 
)-- 
;-- 
}.. 
}// ◊@
J/Users/hakan/Documents/flo_2025_dotnet/RestApi/Services/PasswordManager.cs
public 
class 
PasswordManager 
{ 
private 
readonly 
byte 
[ 
] 
_key  
;  !
private		 
readonly		 
byte		 
[		 
]		 
_iv		 
;		  
string

 


_secretKey

 
=

 
$str

 F
;

F G
public 

PasswordManager 
( 
) 
{ 
using 
( 
var 
deriveBytes 
=  
new! $
Rfc2898DeriveBytes% 7
(7 8

_secretKey 
, 
new 
byte 
[ 
] 
{ 
$num 
, 
$num #
,# $
$num% )
,) *
$num+ /
,/ 0
$num1 5
,5 6
$num7 ;
,; <
$num= A
,A B
$numC G
}H I
,I J
$num 
, 
HashAlgorithmName 
. 
SHA256 $
) 	
)	 

{ 	
_key 
= 
deriveBytes 
. 
GetBytes '
(' (
$num( *
)* +
;+ ,
_iv 
= 
deriveBytes 
. 
GetBytes &
(& '
$num' )
)) *
;* +
} 	
} 
public 

string 
Encrypt 
( 
string  
	plainText! *
)* +
{ 
if 

( 
string 
. 
IsNullOrEmpty  
(  !
	plainText! *
)* +
)+ ,
throw 
new !
ArgumentNullException +
(+ ,
nameof, 2
(2 3
	plainText3 <
)< =
)= >
;> ?
byte   
[   
]   
encryptedBytes   
;   
using"" 
("" 
var"" 
aesAlg"" 
="" 
Aes"" 
.""  
Create""  &
(""& '
)""' (
)""( )
{## 	
aesAlg$$ 
.$$ 
Key$$ 
=$$ 
_key$$ 
;$$ 
aesAlg'' 
.'' 

GenerateIV'' 
('' 
)'' 
;''  
byte(( 
[(( 
](( 
iv(( 
=(( 
aesAlg(( 
.(( 
IV(( !
;((! "
ICryptoTransform** 
	encryptor** &
=**' (
aesAlg**) /
.**/ 0
CreateEncryptor**0 ?
(**? @
aesAlg**@ F
.**F G
Key**G J
,**J K
iv**L N
)**N O
;**O P
using,, 
(,, 
var,, 
	msEncrypt,,  
=,,! "
new,,# &
MemoryStream,,' 3
(,,3 4
),,4 5
),,5 6
{-- 
	msEncrypt// 
.// 
Write// 
(//  
iv//  "
,//" #
$num//$ %
,//% &
iv//' )
.//) *
Length//* 0
)//0 1
;//1 2
using11 
(11 
var11 
	csEncrypt11 $
=11% &
new11' *
CryptoStream11+ 7
(117 8
	msEncrypt118 A
,11A B
	encryptor11C L
,11L M
CryptoStreamMode11N ^
.11^ _
Write11_ d
)11d e
)11e f
using22 
(22 
var22 
	swEncrypt22 $
=22% &
new22' *
StreamWriter22+ 7
(227 8
	csEncrypt228 A
)22A B
)22B C
{33 
	swEncrypt44 
.44 
Write44 #
(44# $
	plainText44$ -
)44- .
;44. /
}55 
encryptedBytes77 
=77  
	msEncrypt77! *
.77* +
ToArray77+ 2
(772 3
)773 4
;774 5
}88 
}99 	
return;; 
Convert;; 
.;; 
ToBase64String;; %
(;;% &
encryptedBytes;;& 4
);;4 5
;;;5 6
}<< 
public>> 

string>> 
Decrypt>> 
(>> 
string>>  

cipherText>>! +
)>>+ ,
{?? 
if@@ 

(@@ 
string@@ 
.@@ 
IsNullOrEmpty@@  
(@@  !

cipherText@@! +
)@@+ ,
)@@, -
throwAA 
newAA !
ArgumentNullExceptionAA +
(AA+ ,
nameofAA, 2
(AA2 3

cipherTextAA3 =
)AA= >
)AA> ?
;AA? @
byteCC 
[CC 
]CC 
cipherBytesCC 
=CC 
ConvertCC $
.CC$ %
FromBase64StringCC% 5
(CC5 6

cipherTextCC6 @
)CC@ A
;CCA B
usingEE 
(EE 
varEE 
aesAlgEE 
=EE 
AesEE 
.EE  
CreateEE  &
(EE& '
)EE' (
)EE( )
{FF 	
aesAlgGG 
.GG 
KeyGG 
=GG 
_keyGG 
;GG 
byteJJ 
[JJ 
]JJ 
ivJJ 
=JJ 
newJJ 
byteJJ  
[JJ  !
$numJJ! #
]JJ# $
;JJ$ %
ArrayKK 
.KK 
CopyKK 
(KK 
cipherBytesKK "
,KK" #
$numKK$ %
,KK% &
ivKK' )
,KK) *
$numKK+ ,
,KK, -
ivKK. 0
.KK0 1
LengthKK1 7
)KK7 8
;KK8 9
aesAlgLL 
.LL 
IVLL 
=LL 
ivLL 
;LL 
ICryptoTransformNN 
	decryptorNN &
=NN' (
aesAlgNN) /
.NN/ 0
CreateDecryptorNN0 ?
(NN? @
aesAlgNN@ F
.NNF G
KeyNNG J
,NNJ K
aesAlgNNL R
.NNR S
IVNNS U
)NNU V
;NNV W
usingPP 
(PP 
varPP 
	msDecryptPP  
=PP! "
newPP# &
MemoryStreamPP' 3
(PP3 4
cipherBytesPP4 ?
,PP? @
$numPPA C
,PPC D
cipherBytesPPE P
.PPP Q
LengthPPQ W
-PPX Y
$numPPZ \
)PP\ ]
)PP] ^
usingQQ 
(QQ 
varQQ 
	csDecryptQQ  
=QQ! "
newQQ# &
CryptoStreamQQ' 3
(QQ3 4
	msDecryptQQ4 =
,QQ= >
	decryptorQQ? H
,QQH I
CryptoStreamModeQQJ Z
.QQZ [
ReadQQ[ _
)QQ_ `
)QQ` a
usingRR 
(RR 
varRR 
	srDecryptRR  
=RR! "
newRR# &
StreamReaderRR' 3
(RR3 4
	csDecryptRR4 =
)RR= >
)RR> ?
{SS 
returnTT 
	srDecryptTT  
.TT  !
	ReadToEndTT! *
(TT* +
)TT+ ,
;TT, -
}UU 
}VV 	
}WW 
public[[ 

string[[ 
GenerateSecureKey[[ #
([[# $
int[[$ '
keySizeInBytes[[( 6
=[[7 8
$num[[9 ;
)[[; <
{\\ 
byte]] 
[]] 
]]] 
key]] 
=]] 
new]] 
byte]] 
[]] 
keySizeInBytes]] ,
]]], -
;]]- .
using^^ 
(^^ 
var^^ 
rng^^ 
=^^ !
RandomNumberGenerator^^ .
.^^. /
Create^^/ 5
(^^5 6
)^^6 7
)^^7 8
{__ 	
rng`` 
.`` 
GetBytes`` 
(`` 
key`` 
)`` 
;`` 
}aa 	
returnbb 
Convertbb 
.bb 
ToBase64Stringbb %
(bb% &
keybb& )
)bb) *
;bb* +
}cc 
}dd Ÿ-
9/Users/hakan/Documents/flo_2025_dotnet/RestApi/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddRateLimiter 
(  
options  '
=>( *
{ 
options 
. 
GlobalLimiter 
= "
PartitionedRateLimiter 2
.2 3
Create3 9
<9 :
HttpContext: E
,E F
stringG M
>M N
(N O
httpContextO Z
=>[ ]
RateLimitPartition 
. !
GetFixedWindowLimiter 0
(0 1
partitionKey 
: 
httpContext %
.% &
User& *
.* +
Identity+ 3
?3 4
.4 5
Name5 9
??: <
httpContext= H
.H I
RequestI P
.P Q
HeadersQ X
.X Y
HostY ]
.] ^
ToString^ f
(f g
)g h
,h i
factory 
: 
	partition 
=> !
new" %)
FixedWindowRateLimiterOptions& C
{ 
AutoReplenishment !
=" #
true$ (
,( )
PermitLimit 
= 
$num 
,  

QueueLimit 
= 
$num 
, 
Window 
= 
TimeSpan !
.! "
FromSeconds" -
(- .
$num. 0
)0 1
} 
) 
) 
; 
} 
) 
; 
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
	UseSqlite 
( 
builder 
. 
Configuration +
.+ ,
GetConnectionString, ?
(? @
$str@ S
)S T
)T U
)U V
;V W
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
var,, 
key,, 
=,, 	
Encoding,,
 
.,, 
ASCII,, 
.,, 
GetBytes,, !
(,,! "
builder,," )
.,,) *
Configuration,,* 7
.,,7 8
GetValue,,8 @
<,,@ A
string,,A G
>,,G H
(,,H I
$str,,I R
),,R S
),,S T
;,,T U
builder-- 
.-- 
Services-- 
.-- 
AddAuthentication-- "
(--" #
JwtBearerDefaults--# 4
.--4 5 
AuthenticationScheme--5 I
)--I J
... 
AddJwtBearer.. 
(.. 
options.. 
=>.. 
{// 
options00 
.00  
RequireHttpsMetadata00 $
=00% &
false00' ,
;00, -
options11 
.11 
	SaveToken11 
=11 
true11  
;11  !
options22 
.22 %
TokenValidationParameters22 )
=22* +
new22, /%
TokenValidationParameters220 I
{33 	$
ValidateIssuerSigningKey44 $
=44% &
true44' +
,44+ ,
IssuerSigningKey55 
=55 
new55 " 
SymmetricSecurityKey55# 7
(557 8
key558 ;
)55; <
,55< =
ValidateIssuer66 
=66 
false66 "
,66" #
ValidateAudience77 
=77 
false77 $
}88 	
;88	 

}99 
)99 
;99 
var;; 
app;; 
=;; 	
builder;;
 
.;; 
Build;; 
(;; 
);; 
;;; 
if>> 
(>> 
!>> 
app>> 
.>> 	
Environment>>	 
.>> 
IsDevelopment>> "
(>>" #
)>># $
)>>$ %
{?? 
app@@ 
.@@ 
UseHsts@@ 
(@@ 
)@@ 
;@@ 
appAA 
.AA 
UseHttpsRedirectionAA 
(AA 
)AA 
;AA 
}CC 
ifJJ 
(JJ 
appJJ 
.JJ 
EnvironmentJJ 
.JJ 
IsDevelopmentJJ !
(JJ! "
)JJ" #
)JJ# $
{KK 
appLL 
.LL %
UseDeveloperExceptionPageLL !
(LL! "
)LL" #
;LL# $
}MM 
appOO 
.OO 
UseMiddlewareOO 
<OO "
ErrorHandlerMiddlewareOO (
>OO( )
(OO) *
)OO* +
;OO+ ,
appPP 
.PP 
UseMiddlewarePP 
<PP 
GlobalMiddlewarePP "
>PP" #
(PP# $
)PP$ %
;PP% &
appQQ 
.QQ 
UseRateLimiterQQ 
(QQ 
)QQ 
;QQ 
appRR 
.RR 
UseHttpsRedirectionRR 
(RR 
)RR 
;RR 
appSS 
.SS 
UseAuthenticationSS 
(SS 
)SS 
;SS 
appTT 
.TT 
UseAuthorizationTT 
(TT 
)TT 
;TT 
appVV 
.VV 
MapControllersVV 
(VV 
)VV 
;VV 
appXX 
.XX 
RunXX 
(XX 
)XX 	
;XX	 
ã	
=/Users/hakan/Documents/flo_2025_dotnet/RestApi/Models/User.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
User 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public

 
string

 
Username

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
=

- .
string

/ 5
.

5 6
Empty

6 ;
;

; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ≥
@/Users/hakan/Documents/flo_2025_dotnet/RestApi/Models/Product.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Product 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[ 	
Required	 
] 
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} Ë	
=/Users/hakan/Documents/flo_2025_dotnet/RestApi/Models/Note.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Note 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
Content 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
[ 	
Required	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
User 
User 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
!- .
;. /
} 
} Ω
I/Users/hakan/Documents/flo_2025_dotnet/RestApi/Models/dto/UserLoginDto.cs
	namespace 	
RestApi
 
. 
Models 
. 
Dto 
{ 
public 

class 
UserLoginDto 
{ 
[

 	
Required

	 
]

 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% (
,( )
MinimumLength* 7
=8 9
$num: ;
,; <
ErrorMessage= I
=J K
$strL {
){ |
]| }
[ 	
EmailAddress	 
( 
ErrorMessage "
=# $
$str% H
)H I
]I J
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% '
,' (
MinimumLength) 6
=7 8
$num9 :
,: ;
ErrorMessage< H
=I J
$strK y
)y z
]z {
[ 	
RegularExpression	 
( 
$str ,
,, -
ErrorMessage. :
=; <
$str= \
)\ ]
]] ^
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
	CityValid	 
( 
ErrorMessage 
=  !
$str" ^
)^ _
]_ `
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ∑9
Y/Users/hakan/Documents/flo_2025_dotnet/RestApi/Migrations/20250311115221_InitialCreate.cs
	namespace 	
RestApi
 
. 

Migrations 
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Price 
= 
table !
.! "
Column" (
<( )
decimal) 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
.   

Annotation   #
(  # $
$str  $ :
,  : ;
true  < @
)  @ A
,  A B
Username!! 
=!! 
table!! $
.!!$ %
Column!!% +
<!!+ ,
string!!, 2
>!!2 3
(!!3 4
type!!4 8
:!!8 9
$str!!: @
,!!@ A
nullable!!B J
:!!J K
false!!L Q
)!!Q R
,!!R S
Password"" 
="" 
table"" $
.""$ %
Column""% +
<""+ ,
string"", 2
>""2 3
(""3 4
type""4 8
:""8 9
$str"": @
,""@ A
nullable""B J
:""J K
false""L Q
)""Q R
,""R S
Role## 
=## 
table##  
.##  !
Column##! '
<##' (
string##( .
>##. /
(##/ 0
type##0 4
:##4 5
$str##6 <
,##< =
nullable##> F
:##F G
false##H M
)##M N
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% /
,''/ 0
x''1 2
=>''3 5
x''6 7
.''7 8
Id''8 :
)'': ;
;''; <
}(( 
)(( 
;(( 
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ 
,++ 
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 
Id.. 
=.. 
table.. 
... 
Column.. %
<..% &
int..& )
>..) *
(..* +
type..+ /
:../ 0
$str..1 :
,..: ;
nullable..< D
:..D E
false..F K
)..K L
.// 

Annotation// #
(//# $
$str//$ :
,//: ;
true//< @
)//@ A
,//A B
Content00 
=00 
table00 #
.00# $
Column00$ *
<00* +
string00+ 1
>001 2
(002 3
type003 7
:007 8
$str009 ?
,00? @
nullable00A I
:00I J
false00K P
)00P Q
,00Q R
UserId11 
=11 
table11 "
.11" #
Column11# )
<11) *
int11* -
>11- .
(11. /
type11/ 3
:113 4
$str115 >
,11> ?
nullable11@ H
:11H I
false11J O
)11O P
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% /
,55/ 0
x551 2
=>553 5
x556 7
.557 8
Id558 :
)55: ;
;55; <
table66 
.66 

ForeignKey66 $
(66$ %
name77 
:77 
$str77 5
,775 6
column88 
:88 
x88  !
=>88" $
x88% &
.88& '
UserId88' -
,88- .
principalTable99 &
:99& '
$str99( /
,99/ 0
principalColumn:: '
:::' (
$str::) -
,::- .
onDelete;;  
:;;  !
ReferentialAction;;" 3
.;;3 4
Cascade;;4 ;
);;; <
;;;< =
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateIndex>> (
(>>( )
name?? 
:?? 
$str?? '
,??' (
table@@ 
:@@ 
$str@@ 
,@@ 
columnAA 
:AA 
$strAA  
)AA  !
;AA! "
}BB 	
	protectedEE 
overrideEE 
voidEE 
DownEE  $
(EE$ %
MigrationBuilderEE% 5
migrationBuilderEE6 F
)EEF G
{FF 	
migrationBuilderGG 
.GG 
	DropTableGG &
(GG& '
nameHH 
:HH 
$strHH 
)HH 
;HH 
migrationBuilderJJ 
.JJ 
	DropTableJJ &
(JJ& '
nameKK 
:KK 
$strKK  
)KK  !
;KK! "
migrationBuilderMM 
.MM 
	DropTableMM &
(MM& '
nameNN 
:NN 
$strNN 
)NN 
;NN 
}OO 	
}PP 
}QQ Õ"
M/Users/hakan/Documents/flo_2025_dotnet/RestApi/Middleware/GlobalMiddleware.cs
public 
class 
GlobalMiddleware 
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 

GlobalMiddleware 
( 
RequestDelegate +
next, 0
)0 1
{		 
_next

 
=

 
next

 
;

 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{ 
string 
path 
= 
context 
. 
Request %
.% &
Path& *
;* +
long 
time 
= 
DateTime 
. 
Now  
.  !
Ticks! &
;& '
string 
ip 
= 
context 
. 

Connection &
.& '
RemoteIpAddress' 6
.6 7
ToString7 ?
(? @
)@ A
;A B
Console 
. 
	WriteLine 
( 
$" 
$str $
{$ %
path% )
}) *
$str* 0
{0 1
ip1 3
}3 4
$str4 8
{8 9
time9 =
}= >
"> ?
)? @
;@ A
if(( 

((( 
context(( 
.(( 
Request(( 
.(( 
ContentType(( '
!=((( *
null((+ /
&&((0 2
context((3 :
.((: ;
Request((; B
.((B C
ContentType((C N
.((N O
Contains((O W
(((W X
$str((X j
)((j k
)((k l
{)) 	
context** 
.** 
Request** 
.** 
EnableBuffering** +
(**+ ,
)**, -
;**- .
using++ 
(++ 
var++ 
reader++ 
=++ 
new++  #
StreamReader++$ 0
(++0 1
context++1 8
.++8 9
Request++9 @
.++@ A
Body++A E
,++E F
Encoding++G O
.++O P
UTF8++P T
,++T U
	leaveOpen++V _
:++_ `
true++a e
)++e f
)++f g
{,, 
var-- 
body-- 
=-- 
await--  
reader--! '
.--' (
ReadToEndAsync--( 6
(--6 7
)--7 8
;--8 9
context.. 
... 
Request.. 
...  
Body..  $
...$ %
Position..% -
=... /
$num..0 1
;..1 2
if00 
(00 
!00 
string00 
.00 
IsNullOrWhiteSpace00 .
(00. /
body00/ 3
)003 4
)004 5
{11 
try22 
{33 
var44 

jsonObject44 &
=44' (
JsonSerializer44) 7
.447 8
Deserialize448 C
<44C D

Dictionary44D N
<44N O
string44O U
,44U V
object44W ]
>44] ^
>44^ _
(44_ `
body44` d
)44d e
;44e f
foreach55 
(55  !
var55! $
kvp55% (
in55) +

jsonObject55, 6
)556 7
{66 
Console77 #
.77# $
	WriteLine77$ -
(77- .
$"77. 0
$str770 5
{775 6
kvp776 9
.779 :
Key77: =
}77= >
$str77> G
{77G H
kvp77H K
.77K L
Value77L Q
}77Q R
"77R S
)77S T
;77T U
}88 
}99 
catch:: 
(:: 
JsonException:: (
ex::) +
)::+ ,
{;; 
Console<< 
.<<  
	WriteLine<<  )
(<<) *
$"<<* ,
$str<<, :
{<<: ;
ex<<; =
.<<= >
Message<<> E
}<<E F
"<<F G
)<<G H
;<<H I
}== 
}>> 
}?? 
}@@ 	
awaitAA 
_nextAA 
(AA 
contextAA 
)AA 
;AA 
}BB 
}DD ú
S/Users/hakan/Documents/flo_2025_dotnet/RestApi/Middleware/ErrorHandlerMiddleware.cs
public 
class "
ErrorHandlerMiddleware #
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 
"
ErrorHandlerMiddleware !
(! "
RequestDelegate" 1
next2 6
)6 7
{ 
_next 
= 
next 
; 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{		 
var 
ip 
= 
context 
. 

Connection #
.# $
RemoteIpAddress$ 3
.3 4
ToString4 <
(< =
)= >
;> ?
var 
headers 
= 
context 
. 
Request %
.% &
Headers& -
;- .
Console 
. 
	WriteLine 
( 
$" 
$str )
{) *
ip* ,
}, -
"- .
). /
;/ 0
foreach 
( 
var 
header 
in 
headers &
)& '
{ 	
Console 
. 
	WriteLine 
( 
$"  
{  !
header! '
.' (
Key( +
}+ ,
$str, .
{. /
header/ 5
.5 6
Value6 ;
}; <
"< =
)= >
;> ?
} 	
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
	Exception 
error 
) 
{ 	
var 
response 
= 
context "
." #
Response# +
;+ ,
response 
. 
ContentType  
=! "
$str# 5
;5 6
await 
response 
. 

WriteAsync %
(% &
error& +
.+ ,
Message, 3
)3 4
;4 5
} 	
} 
} ÷	
K/Users/hakan/Documents/flo_2025_dotnet/RestApi/Data/ApplicationDbContext.cs
	namespace 	
RestApi
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:T U
baseV Z
(Z [
options[ b
)b c
{d e
}f g
public

 
DbSet

 
<

 
User

 
>

 
Users

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
DbSet 
< 
Note 
> 
Notes  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Product 
> 
Products &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ≤
H/Users/hakan/Documents/flo_2025_dotnet/RestApi/CustomValids/CityValid.cs
	namespace 	
RestApi
 
. 
CustomValids 
{ 
public 

class 
	CityValid 
: 
ValidationAttribute 0
{ 
	protected 
override 
ValidationResult +
IsValid, 3
(3 4
object4 :
?: ;
value< A
,A B
ValidationContextC T
validationContextU f
)f g
{ 	
string		 
[		 
]		 
validCities		  
=		! "
{		# $
$str		% /
,		/ 0
$str		1 9
,		9 :
$str		; B
}		C D
;		D E
if

 
(

 
validCities

 
.

 
Contains

 $
(

$ %
value

% *
?

* +
.

+ ,
ToString

, 4
(

4 5
)

5 6
!

6 7
.

7 8
ToLower

8 ?
(

? @
)

@ A
)

A B
)

B C
{ 
return 
ValidationResult '
.' (
Success( /
;/ 0
} 
else 
{ 
return 
new 
ValidationResult +
(+ ,
$str, h
)h i
;i j
} 
} 	
} 
} !
O/Users/hakan/Documents/flo_2025_dotnet/RestApi/Controllers/ProductController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
	Authorize 
( 
Roles 
= 
$str  
)  !
]! "
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
ProductController  
(  ! 
ApplicationDbContext! 5
context6 =
)= >
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Product$ +
product, 3
)3 4
{ 	
_context 
. 
Products 
. 
Add !
(! "
product" )
)) *
;* +
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
product 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public 
IActionResult 
Update #
(# $
int$ '
id( *
,* +
Product, 3
product4 ;
); <
{ 	
var   
existingProduct   
=    !
_context  " *
.  * +
Products  + 3
.  3 4
Find  4 8
(  8 9
id  9 ;
)  ; <
;  < =
if!! 
(!! 
existingProduct!! 
==!!  "
null!!# '
)!!' (
{"" 
return## 
NotFound## 
(##  
)##  !
;##! "
}$$ 
existingProduct%% 
.%% 
Name%%  
=%%! "
product%%# *
.%%* +
Name%%+ /
;%%/ 0
existingProduct&& 
.&& 
Price&& !
=&&" #
product&&$ +
.&&+ ,
Price&&, 1
;&&1 2
_context'' 
.'' 
SaveChanges''  
(''  !
)''! "
;''" #
return(( 
Ok(( 
((( 
existingProduct(( %
)((% &
;((& '
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Delete,, #
(,,# $
int,,$ '
id,,( *
),,* +
{-- 	
var.. 
product.. 
=.. 
_context.. "
..." #
Products..# +
...+ ,
Find.., 0
(..0 1
id..1 3
)..3 4
;..4 5
if// 
(// 
product// 
==// 
null// 
)//  
{00 
return11 
NotFound11 
(11  
)11  !
;11! "
}22 
_context33 
.33 
Products33 
.33 
Remove33 $
(33$ %
product33% ,
)33, -
;33- .
_context44 
.44 
SaveChanges44  
(44  !
)44! "
;44" #
return55 
Ok55 
(55 
)55 
;55 
}66 	
[88 	
HttpGet88	 
]88 
public99 
IActionResult99 
GetAll99 #
(99# $
)99$ %
{:: 	
var;; 
products;; 
=;; 
_context;; #
.;;# $
Products;;$ ,
.;;, -
ToList;;- 3
(;;3 4
);;4 5
;;;5 6
return<< 
Ok<< 
(<< 
products<< 
)<< 
;<<  
}== 	
}>> 
}?? ö 
L/Users/hakan/Documents/flo_2025_dotnet/RestApi/Controllers/NoteController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
	Authorize 
( 
Roles 
= 
$str 
) 
] 
public 

class 
NoteController 
:  !
ControllerBase" 0
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
NoteController 
(  
ApplicationDbContext 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Note$ (
note) -
)- .
{ 	
_context 
. 
Notes 
. 
Add 
( 
note #
)# $
;$ %
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
note 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public 
IActionResult 
Update #
(# $
int$ '
id( *
,* +
Note, 0
note1 5
)5 6
{ 	
var   
existingNote   
=   
_context   '
.  ' (
Notes  ( -
.  - .
Find  . 2
(  2 3
id  3 5
)  5 6
;  6 7
if!! 
(!! 
existingNote!! 
==!! 
null!!  $
)!!$ %
{"" 
return## 
NotFound## 
(##  
)##  !
;##! "
}$$ 
existingNote%% 
.%% 
Content%%  
=%%! "
note%%# '
.%%' (
Content%%( /
;%%/ 0
_context&& 
.&& 
SaveChanges&&  
(&&  !
)&&! "
;&&" #
return'' 
Ok'' 
('' 
existingNote'' "
)''" #
;''# $
}(( 	
[** 	

HttpDelete**	 
(** 
$str** 
)** 
]** 
public++ 
IActionResult++ 
Delete++ #
(++# $
int++$ '
id++( *
)++* +
{,, 	
var-- 
note-- 
=-- 
_context-- 
.--  
Notes--  %
.--% &
Find--& *
(--* +
id--+ -
)--- .
;--. /
if.. 
(.. 
note.. 
==.. 
null.. 
).. 
{// 
return00 
NotFound00 
(00  
)00  !
;00! "
}11 
_context22 
.22 
Notes22 
.22 
Remove22 !
(22! "
note22" &
)22& '
;22' (
_context33 
.33 
SaveChanges33  
(33  !
)33! "
;33" #
return44 
Ok44 
(44 
)44 
;44 
}55 	
[77 	
HttpGet77	 
]77 
public88 
IActionResult88 
GetAll88 #
(88# $
)88$ %
{99 	
var:: 
notes:: 
=:: 
_context::  
.::  !
Notes::! &
.::& '
ToList::' -
(::- .
)::. /
;::/ 0
return;; 
Ok;; 
(;; 
notes;; 
);; 
;;; 
}<< 	
}== 
}>> ùH
L/Users/hakan/Documents/flo_2025_dotnet/RestApi/Controllers/AuthController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
AuthController 
(  
ApplicationDbContext 2
context3 :
,: ;
IConfiguration< J
configurationK X
)X Y
{ 	
_configuration 
= 
configuration *
;* +
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
IActionResult 
Register %
(% &
User& *
user+ /
)/ 0
{ 	
if 
( 

ModelState 
. 
IsValid "
==# %
false& +
)+ ,
{   
return!! 

BadRequest!! !
(!!! "

ModelState!!" ,
)!!, -
;!!- .
}"" 
_context## 
.## 
Users## 
.## 
Add## 
(## 
user## #
)### $
;##$ %
_context$$ 
.$$ 
SaveChanges$$  
($$  !
)$$! "
;$$" #
return%% 
Ok%% 
(%% 
user%% 
)%% 
;%% 
}&& 	
[(( 	
HttpPost((	 
((( 
$str(( 
)(( 
](( 
public)) 
IActionResult)) 
Login)) "
())" #
UserLoginDto))# /
userDto))0 7
)))7 8
{** 	
if++ 
(++ 

ModelState++ 
.++ 
IsValid++ "
==++# %
false++& +
)+++ ,
{,, 
return-- 

BadRequest-- !
(--! "

ModelState--" ,
)--, -
;--- .
}.. 
var// 
user// 
=// 
new// 
User// 
{00 
Username11 
=11 
userDto11 "
.11" #
Username11# +
,11+ ,
Password22 
=22 
userDto22 "
.22" #
Password22# +
}33 
;33 
string55 
passwordHash155  
=55! "
BCrypt55# )
.55) *
Net55* -
.55- .
BCrypt55. 4
.554 5
HashPassword555 A
(55A B
user55B F
.55F G
Password55G O
)55O P
;55P Q
Console66 
.66 
	WriteLine66 
(66 
$str66 1
+662 3
passwordHash1664 A
)66A B
;66B C
PasswordManager88 
passwordManager88 +
=88, -
new88. 1
PasswordManager882 A
(88A B
)88B C
;88C D
string99 
newPass99 
=99 
passwordManager99 ,
.99, -
Encrypt99- 4
(994 5
user995 9
.999 :
Password99: B
)99B C
;99C D
Console:: 
.:: 
	WriteLine:: 
(:: 
$str:: 4
+::5 6
newPass::7 >
)::> ?
;::? @
string<< 
decryptedPass<<  
=<<! "
passwordManager<<# 2
.<<2 3
Decrypt<<3 :
(<<: ;
newPass<<; B
)<<B C
;<<C D
Console== 
.== 
	WriteLine== 
(== 
$str== 4
+==5 6
decryptedPass==7 D
)==D E
;==E F
var?? 
existingUser?? 
=?? 
_context?? '
.??' (
Users??( -
.??- .
FirstOrDefault??. <
(??< =
u??= >
=>??? A
u??B C
.??C D
Username??D L
==??M O
user??P T
.??T U
Username??U ]
)??] ^
;??^ _
if@@ 
(@@ 
existingUser@@ 
!=@@ 
null@@  $
)@@$ %
{AA 
ifCC 
(CC 
BCryptCC 
.CC 
NetCC 
.CC 
BCryptCC %
.CC% &
VerifyCC& ,
(CC, -
userCC- 1
.CC1 2
PasswordCC2 :
,CC: ;
existingUserCC< H
.CCH I
PasswordCCI Q
)CCQ R
)CCR S
{DD 
ConsoleEE 
.EE 
	WriteLineEE %
(EE% &
$strEE& ;
)EE; <
;EE< =
}FF 
elseGG 
{HH 
returnII 
UnauthorizedII '
(II' (
$strII( :
)II: ;
;II; <
}JJ 
}KK 
elseLL 
{MM 
returnNN 
NotFoundNN 
(NN  
$strNN  0
)NN0 1
;NN1 2
}OO 
varRR 
tokenHandlerRR 
=RR 
newRR "#
JwtSecurityTokenHandlerRR# :
(RR: ;
)RR; <
;RR< =
varSS 
JwtKeySS 
=SS 
_configurationSS '
.SS' (
GetValueSS( 0
<SS0 1
stringSS1 7
>SS7 8
(SS8 9
$strSS9 B
)SSB C
??SSD F
$strSSG I
;SSI J
varTT 
keyTT 
=TT 
EncodingTT 
.TT 
ASCIITT $
.TT$ %
GetBytesTT% -
(TT- .
JwtKeyTT. 4
)TT4 5
;TT5 6
varVV 
tokenDescriptorVV 
=VV  !
newVV" %#
SecurityTokenDescriptorVV& =
{WW 
SubjectXX 
=XX 
newXX 
ClaimsIdentityXX ,
(XX, -
newXX- 0
ClaimXX1 6
[XX6 7
]XX7 8
{YY 
newZZ 
ClaimZZ 
(ZZ 

ClaimTypesZZ (
.ZZ( )
NameZZ) -
,ZZ- .
existingUserZZ/ ;
.ZZ; <
UsernameZZ< D
)ZZD E
}[[ 
)[[ 
,[[ 
Expires\\ 
=\\ 
DateTime\\ "
.\\" #
UtcNow\\# )
.\\) *
AddHours\\* 2
(\\2 3
$num\\3 4
)\\4 5
,\\5 6
SigningCredentials]] "
=]]# $
new]]% (
SigningCredentials]]) ;
(]]; <
new]]< ? 
SymmetricSecurityKey]]@ T
(]]T U
key]]U X
)]]X Y
,]]Y Z
SecurityAlgorithms]][ m
.]]m n 
HmacSha256Signature	]]n Å
)
]]Å Ç
}^^ 
;^^ 
if__ 
(__ 
tokenDescriptor__ 
!=__  "
null__# '
)__' (
{`` 
	ParseRoleaa 
(aa 
existingUseraa &
.aa& '
Roleaa' +
,aa+ ,
tokenDescriptoraa- <
)aa< =
;aa= >
}bb 
vardd 
tokendd 
=dd 
tokenHandlerdd $
.dd$ %
CreateTokendd% 0
(dd0 1
tokenDescriptordd1 @
)dd@ A
;ddA B
varee 
tokenStringee 
=ee 
tokenHandleree *
.ee* +

WriteTokenee+ 5
(ee5 6
tokenee6 ;
)ee; <
;ee< =
returngg 
Okgg 
(gg 
newgg 
{gg 
Tokengg !
=gg" #
tokenStringgg$ /
}gg0 1
)gg1 2
;gg2 3
}hh 	
privatejj 
voidjj 
	ParseRolejj 
(jj 
stringjj %
rolesjj& +
,jj+ ,#
SecurityTokenDescriptorjj- D
tokenDescriptorjjE T
)jjT U
{kk 	
varll 
roleListll 
=ll 
rolesll  
.ll  !
Splitll! &
(ll& '
$charll' *
)ll* +
.ll+ ,
Selectll, 2
(ll2 3
rll3 4
=>ll5 7
rll8 9
.ll9 :
Trimll: >
(ll> ?
)ll? @
)ll@ A
.llA B
ToListllB H
(llH I
)llI J
;llJ K
foreachmm 
(mm 
varmm 
rolemm 
inmm  
roleListmm! )
)mm) *
{nn 
tokenDescriptoroo 
.oo  
Subjectoo  '
.oo' (
AddClaimoo( 0
(oo0 1
newoo1 4
Claimoo5 :
(oo: ;

ClaimTypesoo; E
.ooE F
RoleooF J
,ooJ K
roleooL P
)ooP Q
)ooQ R
;ooR S
}pp 
}qq 	
}ss 
}tt 